<!doctype html><html lang="en" data-baseurl="http://example.com" data-apiurl="api/example" data-token=""><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>krel-file-dropper</title><script type="module" crossorigin>(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function e(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(n){if(n.ep)return;n.ep=!0;const i=e(n);fetch(n.href,i)}})();var x=Object.defineProperty,P=(a,t,e)=>t in a?x(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e,w=(a,t,e)=>P(a,typeof t!="symbol"?t+"":t,e);const $={node:null,startX:0,width:0,xPos:0,time:0,delta:0,velocityX:0};class E{constructor(){w(this,"dragToast",$),w(this,"$wrapper",document.createElement("div")),this.init()}init(){this.onDragStart=this.onDragStart.bind(this),this.onDragMove=this.onDragMove.bind(this),this.onDragEnd=this.onDragEnd.bind(this),this.$wrapper.classList.add("krel-toast-wrapper"),this.$wrapper.addEventListener("mousedown",this.onDragStart),this.$wrapper.addEventListener("touchstart",this.onDragStart)}toast(t,e=""){this.$wrapper.children.length||document.body.append(this.$wrapper);const s=document.createElement("div");s.classList.add("krel-toast"),e&&s.classList.add(`krel-toast-${e}`),s.innerHTML=t,s.style.marginTop="30px",this.$wrapper.append(s),setTimeout(()=>{s.style.marginTop="0"},0),s.dataset.id=this.closeTimeOut(s)}error(t){this.toast(t,"error")}success(t){this.toast(t,"success")}onDragStart(t){t.preventDefault();const e=t.target;if(e&&e.closest(".krel-toast")){const s=e.dataset.id;s&&clearTimeout(+s),this.dragToast.node=e,this.dragToast.startX=this.clientX(t),this.dragToast.width=e.offsetWidth,this.dragToast.xPos=this.clientX(t),this.dragToast.time=Date.now(),this.dragToast.node.style.transition="0s",document.addEventListener("mousemove",this.onDragMove),document.addEventListener("mouseup",this.onDragEnd),document.addEventListener("touchmove",this.onDragMove),document.addEventListener("touchend",this.onDragEnd)}}onDragMove(t){this.dragToast.delta=this.clientX(t)-this.dragToast.startX,this.dragToast.xPos=this.dragToast.velocityX=Math.abs(this.dragToast.xPos-this.clientX(t))/(Date.now()-this.dragToast.time),this.dragToast.time=Date.now(),this.dragToast.xPos=this.clientX(t),this.dragToast.node&&this.dragToast.delta&&this.dragToast.width&&(this.dragToast.node.style.transform=`translate(${this.dragToast.delta}px)`,this.dragToast.node.style.opacity=`${1-Math.abs(this.dragToast.delta/(this.dragToast.width*.6))}`)}onDragEnd(t){if(t.preventDefault(),Math.abs(this.dragToast.delta)>this.dragToast.width*.6||this.dragToast.velocityX>1){const e=this.dragToast.node;e&&(e.style.transition="height 0.2s,  padding 0.2s, margin 0.2s",e.style.opacity="0",e.style.height="0",e.style.margin="0",e.style.padding="0",setTimeout(()=>{e.remove()},300))}else this.dragToast.node&&(this.dragToast.node.style.transform="",this.dragToast.node.style.opacity="",this.dragToast.node.style.transition="",this.dragToast.node.dataset.id=this.closeTimeOut(this.dragToast.node));this.dragToast=$,document.removeEventListener("mousemove",this.onDragMove),document.removeEventListener("mouseup",this.onDragEnd),document.removeEventListener("touchmove",this.onDragMove),document.removeEventListener("touchend",this.onDragEnd)}closeTimeOut(t){return setTimeout(()=>{t.style.marginTop="-20px",t.style.opacity="0",setTimeout(()=>{t.remove(),this.$wrapper.children.length||this.$wrapper.remove()},500)},5e3).toString()}clientX(t){if(t.type.includes("touch")){const e=t;if(e.targetTouches.length>=.8)return e.targetTouches[0].screenX}return t.clientX}}new E;const m=new E;class S{$container=document.createElement("div");$preloader=document.createElement("div");preloaderAnimationId=0;constructor(){this.init()}init(){this.initContainer(),this.initPreloader()}start(){document.body.append(this.$container),this.startPrelaoderAnimation()}stop(){document.body.append(this.$container),cancelAnimationFrame(this.preloaderAnimationId),this.setStyle(this.$preloader,{transformOrigin:"",transform:""}),this.$container.remove()}setStyle(t,e){Object.keys(e).forEach(s=>{t.style[s]=e[s]})}initContainer(){this.setStyle(this.$container,{top:"0",bottom:"0",right:"0",screenLeft:"0",zIndex:"100000",position:"absolute",height:"100%",width:"100%",maxWidth:"100vw",maxHeight:"100dvh",display:"flex",alignItems:"center",justifyContent:"center"});const t=document.createElement("div");this.setStyle(t,{background:"#fff",opacity:"0.5",height:"100%",width:"100%",position:"absolute",left:"0",right:"0"}),this.$container.append(t),this.$container.append(this.$preloader)}initPreloader(){this.setStyle(this.$preloader,{position:"relative",zIndex:"12"}),this.$preloader.insertAdjacentHTML("afterbegin",this.returnDefaultPreloaderTempalte())}startPrelaoderAnimation(){const t=performance.now(),e=s=>{const c=(s-t)%2e3/2e3*360;this.setStyle(this.$preloader,{transformOrigin:"50% 50%",transform:`rotate(${c}deg)`}),this.preloaderAnimationId=requestAnimationFrame(e)};this.preloaderAnimationId=requestAnimationFrame(e)}returnDefaultPreloaderTempalte(t="#2c64c0",e=75,s=75){return`<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="display: block;" width="${e}" height="${s}" viewBox="0 0 16 16"><path fill="${t}" d="M15.2 6l-1.1-0.2c-0.1-0.2-0.1-0.4-0.2-0.6l0.6-0.9 0.5-0.7-2.6-2.6-0.7 0.5-0.9 0.6c-0.2-0.1-0.4-0.1-0.6-0.2l-0.2-1.1-0.2-0.8h-3.6l-0.2 0.8-0.2 1.1c-0.2 0.1-0.4 0.1-0.6 0.2l-0.9-0.6-0.7-0.4-2.5 2.5 0.5 0.7 0.6 0.9c-0.2 0.2-0.2 0.4-0.3 0.6l-1.1 0.2-0.8 0.2v3.6l0.8 0.2 1.1 0.2c0.1 0.2 0.1 0.4 0.2 0.6l-0.6 0.9-0.5 0.7 2.6 2.6 0.7-0.5 0.9-0.6c0.2 0.1 0.4 0.1 0.6 0.2l0.2 1.1 0.2 0.8h3.6l0.2-0.8 0.2-1.1c0.2-0.1 0.4-0.1 0.6-0.2l0.9 0.6 0.7 0.5 2.6-2.6-0.5-0.7-0.6-0.9c0.1-0.2 0.2-0.4 0.2-0.6l1.1-0.2 0.8-0.2v-3.6l-0.8-0.2zM15 9l-1.7 0.3c-0.1 0.5-0.3 1-0.6 1.5l0.9 1.4-1.4 1.4-1.4-0.9c-0.5 0.3-1 0.5-1.5 0.6l-0.3 1.7h-2l-0.3-1.7c-0.5-0.1-1-0.3-1.5-0.6l-1.4 0.9-1.4-1.4 0.9-1.4c-0.3-0.5-0.5-1-0.6-1.5l-1.7-0.3v-2l1.7-0.3c0.1-0.5 0.3-1 0.6-1.5l-1-1.4 1.4-1.4 1.4 0.9c0.5-0.3 1-0.5 1.5-0.6l0.4-1.7h2l0.3 1.7c0.5 0.1 1 0.3 1.5 0.6l1.4-0.9 1.4 1.4-0.9 1.4c0.3 0.5 0.5 1 0.6 1.5l1.7 0.3v2z"></path><path fill="${t}" d="M8 4.5c-1.9 0-3.5 1.6-3.5 3.5s1.6 3.5 3.5 3.5 3.5-1.6 3.5-3.5c0-1.9-1.6-3.5-3.5-3.5zM8 10.5c-1.4 0-2.5-1.1-2.5-2.5s1.1-2.5 2.5-2.5 2.5 1.1 2.5 2.5c0 1.4-1.1 2.5-2.5 2.5z"></path></svg>`}}function I(a){const t=document.createElement("tr"),e=`<td>${a.fileName}</td>`,s=`<td><span class="close__btn" data-delete="${a.fileName}">&#10006</span></td>`;return t.innerHTML=`<tr>${e}${s}</tr>`,t}function M(a,t,e){const s=document.getElementById("app"),n=document.querySelector(".answer"),i=["dragenter","dragover","dragleave","drop"],c=new S;let u=[];i.forEach(r=>{s&&(s.addEventListener(r,b,!1),r==="drop"&&s.addEventListener("drop",D,!1))});const f=document.getElementById("fileInput");f&&f.addEventListener("change",r=>{const o=r.target;o.files&&y(o.files)});const p=document.getElementById("files__list");p&&p.addEventListener("click",r=>{const o=r.target;if(o.classList.contains("close__btn")){const d=o.dataset.delete;u=u.filter(l=>(l.info.fileName===d&&l.node!=null&&l.node.remove(),d!==l.info.fileName))}});const v=document.getElementById("btn__send");v&&v.addEventListener("click",async()=>{if(u.length){const r=u.map(o=>o.info);console.log(r),await L(r)}else m.error("Файлы не выбраны")});function b(r){r.preventDefault(),r.stopPropagation()}function D(r){const o=r.dataTransfer;if(o){const d=o.files;y(d)}}function y(r){for(let o=0;o<r.length;o++){const d=r[o];let l=!1;if(u.forEach(h=>{h.info.fileName===d.name&&(l=!0)}),!l&&p){const h={info:{fileName:d.name,data:""}},g=new FileReader;g.onload=()=>{h.info.data=g.result;const T=I(h.info);h.node=T,p.appendChild(T),u.push(h)},g.readAsDataURL(d)}else m.error(`Файл "${d.name}" уже существует в таблице на загрузку`)}}async function L(r){try{const o={"Content-Type":"application/json"};e&&(o.Authorization=`bearer ${e}`);const d=`${a}/${t}`;console.log("url",d),c.start();const l=await fetch(d,{method:"POST",headers:o,body:JSON.stringify(r)});if(console.log(l),l.status===200){m.success("Файлы успешно переданы");const h=await l.json();n&&(n.textContent=JSON.stringify(h,null,2))}else m.error(`Сервер ответил с ошибкой: ${l.status}`),n&&(n.textContent="ошибка")}catch(o){o&&(m.error(`${o}`),console.log(o))}finally{c.stop()}}}document.addEventListener("DOMContentLoaded",()=>{let a,t,e;const s=document.querySelector("html");s&&s.dataset.baseurl&&s.dataset.apiurl?(a=s.dataset.baseurl,t=s.dataset.apiurl,e=s.dataset.baseurl):(console.log("Вы не указали базовую ссылку и ссылку апи в атрибутах тега <html></html>"),a="http://example.com",t="api/test",e=""),M(a,t,e)});</script><style rel="stylesheet" crossorigin>body{--toast-top:0px}.krel-toast-wrapper{width:400px;position:fixed;top:calc(var(--toast-top) + 20px);right:20px;z-index:1000000}.krel-toast{padding:15px;background:#3b3b3dcc;color:#fff;margin-bottom:10px;transition:.4s;position:relative}.krel-toast-error{background:#931c1ccc}.krel-toast-success{background:#009700cc}@media(max-width:991px){.krel-toast-wrapper{position:fixed;inset:auto 0 0;width:100vw}.krel-toast{width:100%}}*,:after{box-sizing:border-box;padding:0;margin:0}#app{width:100vw;height:100dvh;background:#f5f5fa;padding:24px;overflow-y:scroll}.btn{width:max-content;font-weight:700;padding:24px 48px;font-weight:500;font-size:24px;background:#4d90fe;color:#fff;border:#4d90fe;border-radius:12px;cursor:pointer;transition:background-color .1s linear,border .1s linear;margin:0 auto;display:block}.btn:hover{background:#2c64c0;border:#2c64c0}.drop__text{display:block;text-align:center;margin-top:15px}.files__list{width:100%;border-collapse:collapse;margin:30px 0}.files__list td{padding:15px 10px;border-bottom:1px solid #c5c4c4}.files__list td:last-child{width:34px}.close__btn{padding:10px;border-radius:12px;background:#fc5555;font-weight:700;color:#fff;cursor:pointer}.close__btn:hover{background:#dc1919}.answer{background:#f0f0f0;padding:20px;border-radius:30px;margin:20px 0;box-shadow:0 1px 4px #4244541a;background:#f6f6f8;white-space:pre-wrap}</style></head><body><div id="app"><label class="btn" for="fileInput">Выберите файлы</label> <span class="drop__text">или перетащите файлы сюда </span><input type="file" id="fileInput" multiple="multiple" style="display:none"><table class="files__list" id="files__list"><tbody></tbody></table><button class="btn" id="btn__send">Отправить файлы</button><div class="answer">Здесь будет ответ</div></div></body></html>