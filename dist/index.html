<!doctype html><html lang="en" data-baseurl="http://example.com" data-apiurl="api/example" data-token=""><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>krel-file-dropper</title><script type="module" crossorigin>(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const d of n.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&s(d)}).observe(document,{childList:!0,subtree:!0});function c(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(o){if(o.ep)return;o.ep=!0;const n=c(o);fetch(o.href,n)}})();function v(r){const a=document.createElement("tr"),c=`<td>${r.fileName}</td>`,s=`<td><span class="close__btn" data-delete="${r.fileName}">&#10006</span></td>`;return a.innerHTML=`<tr>${c}${s}</tr>`,a}const u={toast:r=>console.log(r),error:r=>console.log(r),success:r=>console.log(r)};function I(r,a,c){const s=document.getElementById("app"),o=["dragenter","dragover","dragleave","drop"];let n=[];o.forEach(t=>{s&&(s.addEventListener(t,L,!1),t==="drop"&&s.addEventListener("drop",E,!1))});const d=document.getElementById("fileInput");d&&d.addEventListener("change",t=>{const e=t.target;e.files&&h(e.files)});const p=document.getElementById("files__list");p&&p.addEventListener("click",t=>{const e=t.target;if(e.classList.contains("close__btn")){const l=e.dataset.delete;n=n.filter(i=>(i.info.fileName===l&&i.node!=null&&i.node.remove(),l!==i.info.fileName))}});const g=document.getElementById("btn__send");g&&g.addEventListener("click",async()=>{if(n.length){const t=n.map(e=>e.info);console.log(t),await b(t)}else u.error("Файлы не выбраны")});function L(t){t.preventDefault(),t.stopPropagation()}function E(t){const e=t.dataTransfer;if(e){const l=e.files;h(l)}}function h(t){for(let e=0;e<t.length;e++){const l=t[e];let i=!1;if(n.forEach(f=>{f.info.fileName===l.name&&(i=!0)}),!i&&p){const f={info:{fileName:l.name,data:""}},m=new FileReader;m.onload=()=>{f.info.data=m.result;const y=v(f.info);f.node=y,p.appendChild(y),n.push(f)},m.readAsDataURL(l)}else u.error(`Файл "${l.name}" уже существует в таблице на загрузку`)}}async function b(t){try{const e={"Content-Type":"application/json"};c&&(e.Authorization=`bearer ${c}`);const l=`${r}/${a}`;console.log("url",l);const i=await fetch(l,{method:"POST",headers:e,body:JSON.stringify(t)});console.log(i),i.status===200?u.success("Файлы успешно переданы"):u.error(`Сервер ответил с ошибкой: ${i.status}`)}catch(e){e&&(u.error(`${e}`),console.log(e))}}}document.addEventListener("DOMContentLoaded",()=>{let r,a,c;const s=document.querySelector("html");s&&s.dataset.baseurl&&s.dataset.apiurl?(r=s.dataset.baseurl,a=s.dataset.apiurl,c=s.dataset.baseurl):(console.log("Вы не указали базовую ссылку и ссылку апи в атрибутах тега <html></html>"),r="http://example.com",a="api/test",c=""),I(r,a,c)});</script><style rel="stylesheet" crossorigin>*,:after{box-sizing:border-box;padding:0;margin:0}#app{width:100vw;height:100dvh;background:#f5f5fa;padding:24px;overflow-y:scroll}.btn{width:max-content;font-weight:700;padding:24px 48px;font-weight:500;font-size:24px;background:#4d90fe;color:#fff;border:#4d90fe;border-radius:12px;cursor:pointer;transition:background-color .1s linear,border .1s linear;margin:0 auto;display:block}.btn:hover{background:#2c64c0;border:#2c64c0}.drop__text{display:block;text-align:center;margin-top:15px}.files__list{width:100%;border-collapse:collapse;margin:30px 0}.files__list td{padding:15px 10px;border-bottom:1px solid #c5c4c4}.files__list td:last-child{width:34px}.close__btn{padding:10px;border-radius:12px;background:#fc5555;font-weight:700;color:#fff;cursor:pointer}.close__btn:hover{background:#dc1919}</style></head><body><div id="app"><label class="btn" for="fileInput">Выберите файлы</label> <span class="drop__text">или перетащите файлы сюда </span><input type="file" id="fileInput" multiple="multiple" style="display:none"><table class="files__list" id="files__list"><tbody></tbody></table><button class="btn" id="btn__send">Отправить файлы</button></div></body></html>