<!doctype html><html lang="en" data-baseurl="http://example.com" data-apiurl="api/example" data-token=""><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>krel-file-dropper</title><script type="module" crossorigin>(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function e(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(n){if(n.ep)return;n.ep=!0;const i=e(n);fetch(n.href,i)}})();var $=Object.defineProperty,O=(r,t,e)=>t in r?$(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,y=(r,t,e)=>O(r,typeof t!="symbol"?t+"":t,e);const E={node:null,startX:0,width:0,xPos:0,time:0,delta:0,velocityX:0};class D{constructor(){y(this,"dragToast",E),y(this,"$wrapper",document.createElement("div")),this.init()}init(){this.onDragStart=this.onDragStart.bind(this),this.onDragMove=this.onDragMove.bind(this),this.onDragEnd=this.onDragEnd.bind(this),this.$wrapper.classList.add("krel-toast-wrapper"),this.$wrapper.addEventListener("mousedown",this.onDragStart),this.$wrapper.addEventListener("touchstart",this.onDragStart)}toast(t,e=""){this.$wrapper.children.length||document.body.append(this.$wrapper);const s=document.createElement("div");s.classList.add("krel-toast"),e&&s.classList.add(`krel-toast-${e}`),s.innerHTML=t,s.style.marginTop="30px",this.$wrapper.append(s),setTimeout(()=>{s.style.marginTop="0"},0),s.dataset.id=this.closeTimeOut(s)}error(t){this.toast(t,"error")}success(t){this.toast(t,"success")}onDragStart(t){t.preventDefault();const e=t.target;if(e&&e.closest(".krel-toast")){const s=e.dataset.id;s&&clearTimeout(+s),this.dragToast.node=e,this.dragToast.startX=this.clientX(t),this.dragToast.width=e.offsetWidth,this.dragToast.xPos=this.clientX(t),this.dragToast.time=Date.now(),this.dragToast.node.style.transition="0s",document.addEventListener("mousemove",this.onDragMove),document.addEventListener("mouseup",this.onDragEnd),document.addEventListener("touchmove",this.onDragMove),document.addEventListener("touchend",this.onDragEnd)}}onDragMove(t){this.dragToast.delta=this.clientX(t)-this.dragToast.startX,this.dragToast.xPos=this.dragToast.velocityX=Math.abs(this.dragToast.xPos-this.clientX(t))/(Date.now()-this.dragToast.time),this.dragToast.time=Date.now(),this.dragToast.xPos=this.clientX(t),this.dragToast.node&&this.dragToast.delta&&this.dragToast.width&&(this.dragToast.node.style.transform=`translate(${this.dragToast.delta}px)`,this.dragToast.node.style.opacity=`${1-Math.abs(this.dragToast.delta/(this.dragToast.width*.6))}`)}onDragEnd(t){if(t.preventDefault(),Math.abs(this.dragToast.delta)>this.dragToast.width*.6||this.dragToast.velocityX>1){const e=this.dragToast.node;e&&(e.style.transition="height 0.2s,  padding 0.2s, margin 0.2s",e.style.opacity="0",e.style.height="0",e.style.margin="0",e.style.padding="0",setTimeout(()=>{e.remove()},300))}else this.dragToast.node&&(this.dragToast.node.style.transform="",this.dragToast.node.style.opacity="",this.dragToast.node.style.transition="",this.dragToast.node.dataset.id=this.closeTimeOut(this.dragToast.node));this.dragToast=E,document.removeEventListener("mousemove",this.onDragMove),document.removeEventListener("mouseup",this.onDragEnd),document.removeEventListener("touchmove",this.onDragMove),document.removeEventListener("touchend",this.onDragEnd)}closeTimeOut(t){return setTimeout(()=>{t.style.marginTop="-20px",t.style.opacity="0",setTimeout(()=>{t.remove(),this.$wrapper.children.length||this.$wrapper.remove()},500)},5e3).toString()}clientX(t){if(t.type.includes("touch")){const e=t;if(e.targetTouches.length>=.8)return e.targetTouches[0].screenX}return t.clientX}}new D;const u=new D;function M(r){const t=document.createElement("tr"),e=`<td>${r.fileName}</td>`,s=`<td><span class="close__btn" data-delete="${r.fileName}">&#10006</span></td>`;return t.innerHTML=`<tr>${e}${s}</tr>`,t}function S(r,t,e){const s=document.getElementById("app"),n=document.querySelector(".answer__text"),i=["dragenter","dragover","dragleave","drop"];let c=[];i.forEach(a=>{s&&(s.addEventListener(a,L,!1),a==="drop"&&s.addEventListener("drop",w,!1))});const m=document.getElementById("fileInput");m&&m.addEventListener("change",a=>{const o=a.target;o.files&&T(o.files)});const g=document.getElementById("files__list");g&&g.addEventListener("click",a=>{const o=a.target;if(o.classList.contains("close__btn")){const d=o.dataset.delete;c=c.filter(l=>(l.info.fileName===d&&l.node!=null&&l.node.remove(),d!==l.info.fileName))}});const p=document.getElementById("btn__send");p&&p.addEventListener("click",async()=>{if(c.length){const a=c.map(o=>o.info);console.log(a),await b(a)}else u.error("Файлы не выбраны")});function L(a){a.preventDefault(),a.stopPropagation()}function w(a){const o=a.dataTransfer;if(o){const d=o.files;T(d)}}function T(a){for(let o=0;o<a.length;o++){const d=a[o];let l=!1;if(c.forEach(h=>{h.info.fileName===d.name&&(l=!0)}),!l&&g){const h={info:{fileName:d.name,data:""}},f=new FileReader;f.onload=()=>{h.info.data=f.result;const v=M(h.info);h.node=v,g.appendChild(v),c.push(h)},f.readAsDataURL(d)}else u.error(`Файл "${d.name}" уже существует в таблице на загрузку`)}}async function b(a){try{const o={"Content-Type":"application/json"};e&&(o.Authorization=`bearer ${e}`);const d=`${r}/${t}`;console.log("url",d);const l=await fetch(d,{method:"POST",headers:o,body:JSON.stringify(a)});if(console.log(l),l.status===200){u.success("Файлы успешно переданы");const h=await l.json();n&&(n.textContent=JSON.stringify(h,null,2))}else u.error(`Сервер ответил с ошибкой: ${l.status}`),n&&(n.textContent="ошибка")}catch(o){o&&(u.error(`${o}`),console.log(o))}}}document.addEventListener("DOMContentLoaded",()=>{let r,t,e;const s=document.querySelector("html");s&&s.dataset.baseurl&&s.dataset.apiurl?(r=s.dataset.baseurl,t=s.dataset.apiurl,e=s.dataset.baseurl):(console.log("Вы не указали базовую ссылку и ссылку апи в атрибутах тега <html></html>"),r="http://example.com",t="api/test",e=""),S(r,t,e)});</script><style rel="stylesheet" crossorigin>body{--toast-top:0px}.krel-toast-wrapper{width:400px;position:fixed;top:calc(var(--toast-top) + 20px);right:20px;z-index:1000000}.krel-toast{padding:15px;background:#3b3b3dcc;color:#fff;margin-bottom:10px;transition:.4s;position:relative}.krel-toast-error{background:#931c1ccc}.krel-toast-success{background:#009700cc}@media(max-width:991px){.krel-toast-wrapper{position:fixed;inset:auto 0 0;width:100vw}.krel-toast{width:100%}}*,:after{box-sizing:border-box;padding:0;margin:0}#app{width:100vw;height:100dvh;background:#f5f5fa;padding:24px;overflow-y:scroll}.btn{width:max-content;font-weight:700;padding:24px 48px;font-weight:500;font-size:24px;background:#4d90fe;color:#fff;border:#4d90fe;border-radius:12px;cursor:pointer;transition:background-color .1s linear,border .1s linear;margin:0 auto;display:block}.btn:hover{background:#2c64c0;border:#2c64c0}.drop__text{display:block;text-align:center;margin-top:15px}.files__list{width:100%;border-collapse:collapse;margin:30px 0}.files__list td{padding:15px 10px;border-bottom:1px solid #c5c4c4}.files__list td:last-child{width:34px}.close__btn{padding:10px;border-radius:12px;background:#fc5555;font-weight:700;color:#fff;cursor:pointer}.close__btn:hover{background:#dc1919}.answer{background:#f0f0f0;padding:20px;border-radius:30px;margin:20px 0;box-shadow:0 1px 4px #4244541a;background:#f6f6f8}</style></head><body><div id="app"><label class="btn" for="fileInput">Выберите файлы</label> <span class="drop__text">или перетащите файлы сюда </span><input type="file" id="fileInput" multiple="multiple" style="display:none"><table class="files__list" id="files__list"><tbody></tbody></table><button class="btn" id="btn__send">Отправить файлы</button><div class="answer"><pre>
          <div class="answer__text">
            Здесь будет ответ
          </div>
        </pre></div></div></body></html>